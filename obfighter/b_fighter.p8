pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--one bit fighter
--@thomasmichaelwallace

--button detection
function any_btn()
	return btn()>0 -- or btn(1)
end

--state
ctr={}
opp={}
gme={}

function _init()
 ctr={
  w=0,--wait
  h=false,--hit
 }
 opp={
  w=0,--wait
  h=false,--hit
 }
 gme={
  l=3,--left sprite
  r=3,--right sprite
  p=0,--points
  s=15,--refresh rate
  w=false,--win mode
 }
end

function _update()
 if(gme.w)then
  --win mode
  ctr.w-=1
  if(ctr.w>-gme.s)return
  if(any_btn())then
   _init()
  end
  return
 end
  
 --player
 if(ctr.h)then
  gme.p-=1
  ctr.h=false
  gme.l=3
  ctr.w=gme.s
 elseif(ctr.w>0)then
  --waiting
  ctr.w-=1
 elseif(ctr.w==0)then
  --animating
  ctr.w=gme.s
  if(gme.l==0)then
   gme.l=3--up to guard
  elseif(gme.l==1)then
   if(any_btn())then
    gme.l=2--double punch
   else
    gme.l=0--punch to up
   end
  elseif(gme.l==2)then
   gme.l=0--dbl to up
  elseif(gme.l==3)then
   ctr.w=-1--actionable
  end
 elseif(any_btn())then
  --button down
  gme.l=1
  ctr.w=gme.s
 end
 
 --opponent
 if(
  gme.r==0 and not opp.h and
  (gme.l==1 or gme.l==2)
 )then
  --hit
  opp.h=true
  gme.r=4
  opp.w=8
 elseif(opp.w>0)then
  --waiting
  opp.w-=1
 elseif(opp.w==0)then
  --animating
  opp.w=gme.s
  if(opp.h)then
   gme.p+=1
   opp.h=false
   gme.r=3
   opp.w=gme.s-gme.p
  elseif(gme.r==0)then
   gme.r=3
  elseif(gme.r==1)then
   if(gme.p>0 and
    rnd(1)<0.25*gme.p)then
    gme.r=2
   else
    gme.r=0
   end
  elseif(gme.r==2)then
   gme.r=0
  elseif(gme.r==3)then
   if(rnd(1)<0.5)then
    gme.r=1
   end
  end
 end
 
 if(gme.l==0 and not ctr.h)then
  --can be hit
  if(gme.r==1 or gme.r==2)then
   --hit
   ctr.h=true
   gme.l=4
   ctr.w=8
  end
 end
 
 if(gme.p>4 or gme.p<-4)then
  gme.w=true
 end
end

function draw_floor()
 local y=80
 for x=24,128-16-24,16 do
  spr(11,x,y,2,1)
 end
end

function draw_chr(x,m,o)
 local s=1+m*2
 if(o)s+=32
 local y=64
 spr(s,x,y,2,2)
end

function _draw()
 cls()
 draw_floor()
 local c=64+gme.p*8
 draw_chr(c-16,gme.l,false)
 draw_chr(c,gme.r,true)
 
 if(gme.w)then
  local x=(128-8*4)/2
  local y=48
  if(gme.p>0)then
   print("you win!",x,y)
  else
   print("you lose",x,y)
  end
 end
end
__gfx__
00000000000000000000770000000000000000000000000000000700000000000000000000000000000000007777777777777777000000000000000000000000
00000000000000077777770000000000000770000000000777777700000000000000770000000000000000000000000000000000000000000000000000000000
00700700000000700000070000000077777770000000007000000700000000077777770000000000077000007777777777777777000000000000000000000000
00077000000000707777070000000700000070000000007077770700000000700000070000000777777700000000000000000000000000000000000000000000
00077000000000707070700000000707777070000000007077070000000000707777070000007000000700000007000000007000000000000000000000000000
00700700000000077777770000000707070700000000000777777700000000707070700000007077770700000000000000000000000000000000000000000000
00000000000000700777000000000077777770000000000007770000000000077777770000007070707000000000000000000000000000000000000000000000
00000000000007000000700000000700777000000000000000000000000000000777000000000777777700000000000000000000000000000000000000000000
00000000000007007700070000000070000777770000000070007000000000070000077000000007770000000000000000000000000000000000000000000000
00000000000007777700070000000070077000770000000077777777000000070077077000070700000000000000000000000000000000000000000000000000
00000000000000700007770000000077777700000000000000000077000000070077777000070770770000000000000000000000000000000000000000000000
00000000000000770707700000000007000700000000000777770000000000070777000000070770770000000000000000000000000000000000000000000000
00000000000000070000000000000000000000000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000770777000000000007070770000000000707077000000000770077000000077077700000000000000000000000000000000000000000000000
00000000000000770077000000000077000770000000007700070000000000770077000000077007700000000000000000000000000000000000000000000000
00000000000007770077700000000770000077000000077000077000000007770077700000777007770000000000000000000000000000000000000000000000
00000000007777777700000000000000000000000077777777000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007000000700000000077777777000000070000007000000007777777700000000000000000000000000000000000000000000000000000000000000
00000000007000000700000000070000007000000070000007000000007000000700000000000777777700000000000000000000000000000000000000000000
00000000007077770700000000070000007000000070777707000000007000000700000000007000000700000000000000000000000000000000000000000000
00000000000707070700000000070777707000000000707707000000007077770700000000007000000700000000000000000000000000000000000000000000
00000000000777777000000000007070707000000007777770000000000707070700000000007077770700000000000000000000000000000000000000000000
00000000000077700700000000007777770000000000777000000000000777777000000000000707070700000000000000000000000000000000000000000000
00000000000700000070000000000777007000000000000000000000000077700000000000000777777000000000000000000000000000000000000000000000
00000000007000770070000077777000070000000007000700000000077000007000000000000077700000000000000000000000000000000000000000000000
00000000007000777770000077000770070000007777777700000000077077007000000000000000007070000000000000000000000000000000000000000000
00000000007770000700000000007777770000007700000000000000077777007000000000000077077070000000000000000000000000000000000000000000
00000000000770707700000000007000700000000000777770000000000077707000000000000077077070000000000000000000000000000000000000000000
00000000000000007000000000000000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000077707700000000077070700000000007707070000000000077007700000000000007770770000000000000000000000000000000000000000000
00000000000077007700000000077000770000000000700077000000000077007700000000000007700770000000000000000000000000000000000000000000
00000000000777007770000000770000077000000007700007700000000777007770000000000077700777000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000007700000777777770000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000777777700000700000070000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000007000000700000700000070000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000007077770700000707777070000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000007070707000000070707070000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000777777700000077777700000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000007770000000007770070000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000700000770777770000700000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000700770770770007700700000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000700777770000077777700000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000707770000000070007000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000007700770000000770707000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000007700770000000770007700000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000077700777000007700000770000000000000000000000000000000000000
00000000000000000000000077777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000077777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000070000000070000007000000007000000700000000700000070000000070000007000000007000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

