pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--gane

function _init()
 palt(0,false)
 w=m_world(0,0)
 p=m_player(5,3)
 t=m_text({'hello'})
end

function _update()
 t:_update()
 if (not t.show) p:_update()
end

function _draw()
 cls()
 w:_draw()
	p:_draw()
	t:_draw()
end
-->8
-- player

function m_player(mx,my)
	local p = {
	 x=mx*8,
	 y=my*8,
	 s=1,
	 
	 action='idle',
	 actions={
	  idle={frames={64,64,65,65}},
	  -- moves
	  down={frames={64,66}},
	  up={frames={67,68}},
	  right={frames={69,70}},
	  left={frames={-69,-70}},
	 },
	 tick=0,
	 frame=0,
	 
	 check=function(self,dx,dy)
	  local cv=mget(self.x/8,self.y/8)
	  local nv=mget(self.x/8+dx,self.y/8+dy)
   -- door detection
	  if fget(cv,1) then
	   w.open=false
	  end
	  if fget(nv,1) then
	   w.open=true
	  end
	  -- colision detection
	 	return not fget(nv,0)
	 end,
	 
	 ctrl=function(self)
	 	if (self.x%8==0
			 and self.y%8==0)
			then
			 self.action='idle'
			end
	  if self.action=='idle' then 
				if btn(0) and self:check(-1,0) then
				 self.action='left'
				elseif btn(1) and self:check(1,0) then
					self.action='right'
				elseif btn(2) and self:check(0,-1) then
				 self.action='up'
				elseif btn(3) and self:check(0,1) then
					self.action='down'
				end
	  end
	 end,

  anim=function(self)
   self.tick+=1
   if (self.tick==4) then
   	self.tick=0
   	self.frame+=1
   	local a=self.actions[self.action]
   	if (self.frame>#a.frames) self.frame=1
   	self.s=a.frames[self.frame]
   end
   if (self.action=='left') then
    self.x-=1
   elseif (self.action=='right') then
    self.x+=1
   elseif (self.action=='up') then
    self.y-=1
   elseif (self.action=='down') then
    self.y+=1
   end
  end,
	 
	 _update=function(self)
	  self:ctrl()
   self:anim()
	 end,
	 
  _draw=function(self)
   palt(14,true)
   if self.s<0 then
    spr(-self.s,self.x,self.y,1,1,true)
   else
  	 spr(self.s,self.x,self.y)
   end
   palt(14,false)
   --debug
   print(1,0,0)
   print(self.frame,0,8)
   print(self.action,0,16)
  end,
	}
	return p
end
-->8
-- world

function m_world(x,y)
 local w={
 	x=x,
 	y=y,
 	open=false,
 	_draw=function(self)
 	 map(self.x,self.y,0,0,16,16)
 	 if (self.open) then
 	 	spr(34,9*8,6*8)
 	 end
 	end,
 }
 return w
end
-->8
-- text

function m_text(lines)
 local t={
  lines=lines,
  show=true,  
  
  _update=function(self)
  	if btnp(4) or btnp(5) then
  	 self.show=false
  	end
  end,
  
  _draw=function(self)
   if (not t.show) return false
   local h=8*#self.lines
   rectfill(6,38,122,50+h,0)
   rect(8,40,120,48+h,6)
   local y=46
   for l in all(self.lines) do
    print(l,14,y,7)
    y+=8
   end
  end,
  
 }
 return t
end
__gfx__
00000000ee33eeee222222224444444455555555ff2222ff44555544055555555555555555555550574404055550ff443333333344ff05550000000000000000
00000000ef333fee22222dd24ff4444454444445f200002f4555555450777777777777777777770557440405000044f433bb33334f4400000000000000000000
00700700ef0f0fee2222222244444444544455452e222282456666545704444044404444044440755744040544404ff4333333334ff404440000000000000000
00077000eefffeee2222222244444444544444452ee8888256777765574044404440444404440475574400050000f44433333333444f00000000000000000000
00077000ee333eee2222222244444444555555552e8e8882567777655744000000000000000044755700040544404ff4333333334ff404440000000000000000
00700700ee333eee2222222244444444544444452ee888825666666557440044444404444400447557440405444044f4333333334f4404440000000000000000
00000000e3bbbeee2dd2222244444ff454444445228e882257777775574404000000000000404475574404057770ff4433333bb344ff07770000000000000000
00000000eb3e33ee22222222ffffffff55555555422222245667777557000405555555555040007557440405555044f4333333334f4405550000000000000000
00000000433b444433444433f4444445444444444444444457777775570004055555555550400075504044750666666667766666666666606000000000000000
00000000333b33bb344ff44345044444433333444333334457777775574404000000000000404475504044756667766666666666776666666000000000000000
00000000bb3bb3b334ffff434444f444433bb333333bb33356667765574400444440444444004475504044756666666666666556666666666000000000000000
000000003b33b3b3344ff44344444454443bbbbbbbbbbbbb56777775574400000000000000004475504000756666666666666666666666766000000000000000
000000003bb3b3b334f44f4344f40444443bbbbbbbbbbbbb57777775574044404444044404440475500044756666655555555555555666765000000000000000
0000000033b3bbb334ff5f4344444444433bbb3bbbbbb33b57777775570444404444044404444075504044756666550000000000005566660000000000000000
0000000043bb3b3334ff5f4340444f4443bbbbbbbbbbbbbb55555555507777777777777777777705504044756766500aaaaaaaaaa0056666a000000000000000
00000000433b3b3434f5ff434454444043bbbbbb33bbbbbb4500005405555555555555555555555050404475676650a0000000000a0566660000000000000000
00000000888888888844444400000000443bbbbbbbbbbbbb444ffff444ffff44555555544555555500000000666650a0000000000a0566666000000000000000
00000000888888888805505400000000443bb33bbbbbbbbbfff1111fff1111f4000000555500000000000000665650a0000000000a0566676000000000000000
00000000f0550aaf8855055f00000000433bbbbbbb33bbbb1111cc11111cc11f404440055004440400000000665650a0000000000a0566676000000000000000
00000000f550550f8850550f0000000043bbbbbbbbbbbbbbcccccccccccccc1f000004055040000000000000666650a0777777770a0566666000000000000000
00000000f505505f8805505f0000000043bbbbbbbbbbbbbbcccccccccccccc1f444004055040044400000000666650a0777777770a0566666000000000000000
00000000ffffffff88afffff00000000433bbbbbbbbb33bbccccccccccccc11f440404055000404400000000766650a0000000000a0565665000000000000000
000000004444444488a4444400000000433bbb33bbbbbbbbc11cccccc11cc1f4774404055040447700000000766650a0000000000a0565665000000000000000
0000000045444f4488444f4400000000443bbbbbbbbbbbbbccccccccccccc1f4074400055040447000000000666650a0000000000a0566660000000000000000
0000000000000000000000000000000000000000555555555555555555555555574404055040007500000000666650a0000000000a0566766000000000000000
00000000000000000000000000000000000000000000777777777777777700005700040000404475000000006666500aaaaaaaaaa00566766000000000000000
00000000000000000000000000000000000000004440cccccccccccccccc04445744004444004475000000006666550000000000005566666000000000000000
00000000000000000000000000000000000000000000cc77cccccc7777cc00005744000000004475000000006766655555555555555666666000000000000000
00000000000000000000000000000000000000004440cccccccccccccccc04445740444404440475000000006766666666666666666666665000000000000000
00000000000000000000000000000000000000004440544444444444444504445704444404444075000000006666666665566666666666660000000000000000
0000000000000000000000000000000000000000777054444444444444450777507777777777770500000000666666776666666666677666a000000000000000
00000000000000000000000000000000000000005555544444444444444555550555555555555550000000000666666666666776666666600000000000000000
ee3beeeeeeeeeeeeeeb3eeeeeee3beeeeeeb3eeeeee3eeeeeee3eeee000000000000000000000000000000000000000000000000000000000000000000000000
ef333feeeeb3eeeeef333feeef333feeef333feeee3f3eeeee3f3eee000000000000000000000000000000000000000000000000000000000000000000000000
ef0f0feeef333feeef0f0feeef333feeef333feeee3f0eeeee3f0eee000000000000000000000000000000000000000000000000000000000000000000000000
eefffeeeef0f0feeeefffeeeee333eeeee333eeeee3fffeeee3fffee000000000000000000000000000000000000000000000000000000000000000000000000
ee333eeeeefffeeeee333eeeee333eeeee333eeeeee3feeeeee3feee000000000000000000000000000000000000000000000000000000000000000000000000
ee333eeeee333eeeee333eeeee333eeeee333eeeee3f3eeeee3f3eee000000000000000000000000000000000000000000000000000000000000000000000000
e3bbbeeee3bbbeeeeebbb3eee3bbbeeeeebbb3eeeeebb3eeee3fbeee000000000000000000000000000000000000000000000000000000000000000000000000
eb3e33eeeb3e33eee33e3beee33e33eee33e33eeee333eeeeee333ee000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000010101010101010001000000000100000001010101010000000000000202000000000001010000000000000000000000010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1111111111111111111111111111111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1107080808080808080808080911111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
110a020602020203030305051a11111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
110a021602020203030303051a11111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
110a020202020203030303051a11111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
110a030303030303030303031a11111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11172803030303290b210d181911111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111383536363739121312111111111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111121312111111111200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121312121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313131313131313131313131313131300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121314151515151500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111121324252525252500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626262626262627121324252525252500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
